# Description:  An event-driven initramfs infrastructure
# URL:          https://dracut.wiki.kernel.org/index.php/Main_Page
# Maintainer:   Alexandr Savca, drop at chinarulezzz dot fun

name=dracut
version=049
release=2
source=(https://mirrors.edge.kernel.org/pub/linux/utils/boot/$name/$name-$version.tar.xz
	$name-bash5.patch
	10-crux.conf
	installkernel
	arch)

build() {
	cd $name-$version

	patch -p1 -i $SRC/$name-bash5.patch

	./configure \
		--prefix=/usr \
		--sysconfdir=/etc
	make
	make DESTDIR=$PKG install

	# initrd config
	cp $SRC/10-crux.conf $PKG/etc/dracut.conf.d/
	# kernel install script
	install -Dm 0755 $SRC/installkernel $PKG/sbin/installkernel
	# fix "/usr/lib/dracut/modules.d/90crypt/module-setup.sh: line 28: arch: command not found"
	install -Dm 0755 $SRC/arch $PKG/bin/arch

	rm $PKG/usr/lib/$name/modules.d/*/README*
}
